function get_bin() {
  local bin_name=$1
  curl "https://raw.githubusercontent.com/leynos/agent-helper-scripts/refs/heads/main/${bin_name}" -o "/usr/local/bin/${bin_name}"
  chmod 755 "/usr/local/bin/${bin_name}"
}

# Install glow
INSTALL_GLOW=${INSTALL_GLOW:-0}
if ((INSTALL_GLOW)); then
  mkdir -p /etc/apt/keyrings
  curl -fsSL https://repo.charm.sh/apt/gpg.key | sudo gpg --dearmor -o /etc/apt/keyrings/charm.gpg
  echo "deb [signed-by=/etc/apt/keyrings/charm.gpg] https://repo.charm.sh/apt/ * *" | tee /etc/apt/sources.list.d/charm.list
  apt update -y && apt install -y glow
fi

# Mermaid dependencies
sudo apt update -y
sudo apt install -y \
  libxcomposite1 libxdamage1 libxrandr2 libxss1 libxtst6 \
  libgbm1 libdrm2 libxshmfence1 \
  libnspr4 libnss3 \
  libcups2t64 libasound2t64 \
  libatk1.0-0t64 libatk-bridge2.0-0t64 libatspi2.0-0t64 \
  libx11-xcb1 libxkbcommon0 \
  libpango-1.0-0 libpangocairo-1.0-0 \
  libgtk-3-0t64 libglib2.0-0t64 \
  fonts-liberation ca-certificates \
  libx11-6 libxext6 libxfixes3 libxcb1

bun install --global markdownlint-cli2 markdown-table-formatter
get_bin markdownlint
time bun install --global @mermaid-js/mermaid-cli
uv tool install --from git+https://github.com/leynos/nixie nixie
uv tool install mdformat
get_bin mdformat-all

MDTABLEFIX_VERSION=${MDTABLEFIX_VERSION:-0.1.0}
pushd /usr/local/bin
wget -O mdtablefix https://github.com/leynos/mdtablefix/releases/download/v${MDTABLEFIX_VERSION}/mdtablefix-linux-x86_64
chmod 755 mdtablefix
popd
